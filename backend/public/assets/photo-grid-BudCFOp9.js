import{c as E,r as i,j as e,b as S,D as _,t as V,B as N,L as A}from"./index-28yYTQYt.js";import{C as U,b as B,a as H,f as W}from"./card-Da7qCGoe.js";import{I as F,a as q}from"./loading-button-BkylZ5sb.js";import{m as G}from"./useVacationGalleryApi-CYdJb4Ya.js";import{b as K,u as X}from"./index.esm-Bnp_jBhY.js";import{D as Z,a as J,d as Q,b as Y,h as ee,f as te,e as se,C as ne}from"./date-input-67k-hZ35.js";import{O as ie,T as re,M as ae}from"./openstreetmap-C_Emiqu9.js";import{L as oe,N as le,C as ce}from"./location-search-CVZT0ayL.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],ue=E("crosshair",de);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],R=E("map-pin",he);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],xe=E("pen-line",fe);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],pe=E("rotate-ccw",me),ge=i.createContext({});function z(t){const o=i.useRef(null);return o.current===null&&(o.current=t()),o.current}const je=typeof window<"u",we=je?i.useLayoutEffect:i.useEffect,T=i.createContext(null);function Ce(t){return typeof t=="object"&&t!==null}function ye(t){return Ce(t)&&"offsetHeight"in t}const ve=i.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class Ne extends i.Component{getSnapshotBeforeUpdate(o){const s=this.props.childRef.current;if(s&&o.isPresent&&!this.props.isPresent){const n=s.offsetParent,r=ye(n)&&n.offsetWidth||0,a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft,a.right=r-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ke({children:t,isPresent:o,anchorX:s,root:n}){const r=i.useId(),a=i.useRef(null),l=i.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=i.useContext(ve);return i.useInsertionEffect(()=>{const{width:g,height:c,top:u,left:d,right:m}=l.current;if(o||!a.current||!g||!c)return;const f=s==="left"?`left: ${d}`:`right: ${m}`;a.current.dataset.motionPopId=r;const p=document.createElement("style");h&&(p.nonce=h);const C=n??document.head;return C.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${c}px !important;
            ${f}px !important;
            top: ${u}px !important;
          }
        `),()=>{C.contains(p)&&C.removeChild(p)}},[o]),e.jsx(Ne,{isPresent:o,childRef:a,sizeRef:l,children:i.cloneElement(t,{ref:a})})}const be=({children:t,initial:o,isPresent:s,onExitComplete:n,custom:r,presenceAffectsLayout:a,mode:l,anchorX:h,root:g})=>{const c=z(Le),u=i.useId();let d=!0,m=i.useMemo(()=>(d=!1,{id:u,initial:o,isPresent:s,custom:r,onExitComplete:f=>{c.set(f,!0);for(const p of c.values())if(!p)return;n&&n()},register:f=>(c.set(f,!1),()=>c.delete(f))}),[s,c,n]);return a&&d&&(m={...m}),i.useMemo(()=>{c.forEach((f,p)=>c.set(p,!1))},[s]),i.useEffect(()=>{!s&&!c.size&&n&&n()},[s]),l==="popLayout"&&(t=e.jsx(ke,{isPresent:s,anchorX:h,root:g,children:t})),e.jsx(T.Provider,{value:m,children:t})};function Le(){return new Map}function Ee(t=!0){const o=i.useContext(T);if(o===null)return[!0,null];const{isPresent:s,onExitComplete:n,register:r}=o,a=i.useId();i.useEffect(()=>{if(t)return r(a)},[t]);const l=i.useCallback(()=>t&&n&&n(a),[a,n,t]);return!s&&n?[!1,l]:[!0]}const L=t=>t.key||"";function $(t){const o=[];return i.Children.forEach(t,s=>{i.isValidElement(s)&&o.push(s)}),o}const Pe=({children:t,custom:o,initial:s=!0,onExitComplete:n,presenceAffectsLayout:r=!0,mode:a="sync",propagate:l=!1,anchorX:h="left",root:g})=>{const[c,u]=Ee(l),d=i.useMemo(()=>$(t),[t]),m=l&&!c?[]:d.map(L),f=i.useRef(!0),p=i.useRef(d),C=z(()=>new Map),[P,M]=i.useState(d),[y,k]=i.useState(d);we(()=>{f.current=!1,p.current=d;for(let w=0;w<y.length;w++){const x=L(y[w]);m.includes(x)?C.delete(x):C.get(x)!==!0&&C.set(x,!1)}},[y,m.length,m.join("-")]);const b=[];if(d!==P){let w=[...d];for(let x=0;x<y.length;x++){const v=y[x],D=L(v);m.includes(D)||(w.splice(x,0,v),b.push(v))}return a==="wait"&&b.length&&(w=b),k($(w)),M(d),null}const{forceRender:j}=i.useContext(ge);return e.jsx(e.Fragment,{children:y.map(w=>{const x=L(w),v=l&&!c?!1:d===y||m.includes(x),D=()=>{if(C.has(x))C.set(x,!0);else return;let I=!0;C.forEach(O=>{O||(I=!1)}),I&&(j==null||j(),k(p.current),l&&(u==null||u()),n&&n())};return e.jsx(be,{isPresent:v,initial:!f.current||s?void 0:!1,custom:o,presenceAffectsLayout:r,mode:a,root:g,onExitComplete:v?void 0:D,anchorX:h,children:w},x)})})};function Me({src:t,className:o,...s}){const[n,r]=i.useState(!1),[a,l]=i.useState(!1);return e.jsxs("div",{className:S("relative overflow-hidden",o),...s,children:[e.jsx("img",{width:t.dimensions.width,height:t.dimensions.height,className:"object-cover h-auto",src:t.originalUrl,onLoad:()=>r(!0)}),!n&&e.jsx("img",{src:t.thumbnailUrl,width:t.dimensions.width,height:t.dimensions.height,className:"absolute top-0 left-0 object-cover h-auto",onLoad:()=>l(!0)}),e.jsx(Pe,{children:!n&&e.jsx("div",{className:S("w-full absolute h-full top-0 left-0 flex justify-center items-center bg-gray-600 transition-all opacity-100",a&&"opacity-30"),children:e.jsx(_,{})})})]})}const De=({onLocationPicked:t,initialLocation:o,open:s,onCancel:n})=>{const[r,a]=i.useState(null),l=i.useRef(null);i.useEffect(()=>{var d,m;const u=f=>{a(f.latlng)};if(s&&(o&&(o.lat!==0||o.lng!==0)?(d=l.current)==null||d.setView(o,8):h()),l.current)return(m=l.current)==null||m.addEventListener("click",u),()=>{var f;(f=l.current)==null||f.removeEventListener("click",u)}},[o,s,l.current]);const h=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(u=>{const d={lat:u.coords.latitude,lng:u.coords.longitude};a(d),V.success("Located your current position")})};i.useEffect(()=>{var u;r&&((u=l.current)==null||u.setView(r,4))},[r]);const g=()=>{a(null)},c=()=>{r&&t(r)};return e.jsx(Z,{open:s,onOpenChange:n,children:e.jsxs(J,{className:"max-w-7xl p-0 overflow-hidden flex flex-col",children:[e.jsxs(Q,{className:"px-6 pt-6 pb-4",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Set Photo Location"]}),e.jsx(ee,{children:"Search for places, click on the map, or enter coordinates manually"})]}),e.jsx("div",{className:"flex-1 overflow-hidden min-h-0 px-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(95vh-200px)] grid-rows-[auto_1fr] lg:grid-rows-1",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4 max-h-full pr-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search Places"}),e.jsx(oe,{onSelect:u=>a(u)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:h,className:"flex-1",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Current Location"]}),e.jsx(N,{variant:"outline",size:"sm",onClick:g,children:e.jsx(pe,{className:"w-4 h-4"})})]}),r&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ue,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Selected Location"})]}),e.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300 font-mono",children:["Lat: ",r.lat.toFixed(6),e.jsx("br",{}),"Lng: ",r.lng.toFixed(6)]})]})]}),e.jsxs(ie,{ref:l,className:"rounded-lg overflow-hidden w-full max-h-full grow",scrollWheelZoom:!0,children:[e.jsx(re,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),r&&e.jsx(ae,{position:[r.lat,r.lng],icon:A.divIcon({className:"custom-div-icon",html:'<div style="background-color: #ef4444; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',iconSize:[24,24],iconAnchor:[12,12]})})]})]})}),e.jsx(te,{className:"px-6 py-4 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:r?`Location: ${r.lat.toFixed(4)}, ${r.lng.toFixed(4)}`:"Search, click on map, or enter coordinates to select location"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",onClick:n,children:"Cancel"}),e.jsxs(N,{onClick:c,disabled:!r,className:"gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Confirm Location"]})]})]})})]})})};function Se({value:t,onChange:o,initialLocation:s,...n}){const[r,a]=i.useState(!1),l=i.useMemo(()=>t?`${t.lat.toFixed(2)}°, ${t.lng.toFixed(2)}°`:void 0,[t]),h=g=>{a(!1),o(g)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{value:l,placeholder:"Click to select location",onClick:()=>!r&&a(!0),...n}),e.jsx(De,{onLocationPicked:h,initialLocation:t,onCancel:()=>a(!1),open:r})]})}function Re({value:t,onChange:o,disabled:s}){const n=c=>{o({...t,title:c.target.value})},r=c=>{o({...t,description:c.target.value})},a=c=>{o({...t,latitude:c.lat,longitude:c.lng})},l=c=>{o({...t,taken_at:c==null?void 0:c.toISOString()})},h=i.useMemo(()=>t.taken_at?new Date(t.taken_at):void 0,[t.taken_at]),g=i.useMemo(()=>t.latitude&&t.longitude?{lat:t.latitude,lng:t.longitude}:void 0,[t.latitude,t.longitude]);return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{placeholder:"Title",value:t.title??"",onChange:n,disabled:s}),e.jsx(K,{placeholder:"Description",value:t.description??"",onChange:r,disabled:s}),e.jsx(se,{onChange:l,value:h,placeholder:"Timestamp",disabled:s,className:"w-full"}),e.jsx(Se,{onChange:a,value:g})]})}function Ie({item:t,onClick:o,selected:s,onSelect:n}){const[r,a]=i.useState(!1),[l,h]=i.useState(!1),{mutateAsync:g,isPending:c}=G(),u=()=>{a(!0)},d=()=>{a(!1)},m=async j=>{await g({id:t.id,data:k}).finally(()=>{a(!1)})},{watch:f,setValue:p,reset:C,handleSubmit:P,formState:{isDirty:M,isValid:y}}=X();i.useEffect(()=>{var j,w,x;C({value:{latitude:(j=t.coordinates)==null?void 0:j.latitude,longitude:(w=t.coordinates)==null?void 0:w.longitude,altitude:(x=t.coordinates)==null?void 0:x.altitude,description:t.description||"",title:t.title||"",taken_at:t.timeISO}})},[t]);const{value:k}=f(),b=i.useMemo(()=>t.mediumLocation,[t]);return e.jsxs(U,{onClick:()=>!n&&o(t),className:`group relative cursor-pointer hover:shadow-lg transition-all p-0 pb-4 break-inside-avoid overflow-hidden mb-4 gap-2 ${s?"ring-2 ring-blue-500 shadow-lg":""}`,children:[e.jsx(B,{className:"p-0",children:e.jsxs("div",{className:"overflow-hidden rounded-t-lg relative",children:[e.jsx(Me,{src:t,className:S("w-full h-auto",s&&"opacity-60"),onClick:()=>n==null?void 0:n(t.id)}),n&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 cursor-pointer transition-all duration-200 ${s?"bg-blue-500 border-blue-500 shadow-lg":"bg-white/90 border-white/90 hover:bg-white hover:scale-110"}`,onClick:j=>{j.stopPropagation(),n(t.id)},children:s&&e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(ce,{className:"w-3 h-3"})})})}),n&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(N,{variant:"secondary",size:"sm",className:"h-8 w-8 p-0",onClick:j=>{j.stopPropagation(),r?d():u()},children:e.jsx(xe,{className:"w-4 h-4"})})})]})}),e.jsx(H,{className:"flex flex-col",children:e.jsxs("div",{className:"",children:[r?e.jsx("div",{children:e.jsx(Re,{value:k,onChange:j=>p("value",j,{shouldValidate:!0,shouldDirty:!0}),disabled:c})}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-semibold mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:t.description})]}),!r&&e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[e.jsx(R,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate cursor-help",title:t.fullLocation,children:b})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),t.formattedTime]})})]})]})}),r&&e.jsxs(W,{className:"gap-2 flex",children:[e.jsx(q,{loading:c,disabled:!M||!y,onClick:P(m),children:"Save"}),e.jsx(N,{variant:"outline",onClick:d,children:"Cancel"})]})]},t.id)}function Ue({photos:t,onClickPhoto:o,onSelectionChange:s,selectedPhotos:n,loading:r}){const a=l=>{const h=new Set(n);n&&n.has(l)?h.delete(l):h.add(l),s==null||s(h)};return e.jsxs(e.Fragment,{children:[r||!t&&e.jsx("div",{className:"grow flex justify-center items-center",children:e.jsx(_,{})}),!r&&t&&e.jsx("div",{className:"columns-1 md:columns-2 lg:columns-3 xl:columns-4 gap-4 grow",children:t.all.map(l=>e.jsx(Ie,{item:l,onClick:o,selected:n==null?void 0:n.has(l.id),onSelect:s?a:void 0},l.id))})]})}export{Pe as A,ge as L,ve as M,T as P,Ce as a,we as b,je as c,Ee as d,R as e,Me as f,Ue as g,Re as h,ye as i,z as u};

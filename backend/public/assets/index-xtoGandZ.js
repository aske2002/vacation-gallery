import{r as v,V as M}from"./index-28yYTQYt.js";import{u as S}from"./openstreetmap-C_Emiqu9.js";import{s as _,t as z}from"./useVacationGalleryApi-CYdJb4Ya.js";import{u as C}from"./useQuery-fXf16oON.js";function b(){return S().map}function R(s){const t=b();return v.useEffect(function(){return t.on(s),function(){t.off(s)}},[t,s]),t}var f={exports:{}},m;function w(){return m||(m=1,function(s){var t={};function n(e){return Math.floor(Math.abs(e)+.5)*(e>=0?1:-1)}function o(e,r,i){e=n(e*i),r=n(r*i);var h=(e-r)*2;h<0&&(h=-h-1);for(var p="";h>=32;)p+=String.fromCharCode((32|h&31)+63),h/=32;return p+=String.fromCharCode((h|0)+63),p}t.decode=function(e,r){for(var i=0,h=0,p=0,u=[],l=0,c=0,d=null,y,x,g=Math.pow(10,Number.isInteger(r)?r:5);i<e.length;){d=null,l=1,c=0;do d=e.charCodeAt(i++)-63,c+=(d&31)*l,l*=32;while(d>=32);y=c&1?(-c-1)/2:c/2,l=1,c=0;do d=e.charCodeAt(i++)-63,c+=(d&31)*l,l*=32;while(d>=32);x=c&1?(-c-1)/2:c/2,h+=y,p+=x,u.push([h/g,p/g])}return u},t.encode=function(e,r){if(!e.length)return"";for(var i=Math.pow(10,Number.isInteger(r)?r:5),h=o(e[0][0],0,i)+o(e[0][1],0,i),p=1;p<e.length;p++){var u=e[p],l=e[p-1];h+=o(u[0],l[0],i),h+=o(u[1],l[1],i)}return h};function a(e){for(var r=[],i=0;i<e.length;i++){var h=e[i].slice();r.push([h[1],h[0]])}return r}t.fromGeoJSON=function(e,r){if(e&&e.type==="Feature"&&(e=e.geometry),!e||e.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return t.encode(a(e.coordinates),r)},t.toGeoJSON=function(e,r){var i=t.decode(e,r);return{type:"LineString",coordinates:a(i)}},s.exports&&(s.exports=t)}(f)),f.exports}var E=w();const L=M(E);var F=class{constructor(s){this.points=s.points||[],this.duration=s.duration||1e4,this.sharpness=s.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=s.stepLength||60,this.length=this.points.length,this.delay=0;for(let t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(let t=0;t<this.length-1;t++){const n=this.points[t],o=this.points[t+1];this.centers.push({x:(n.x+o.x)/2,y:(n.y+o.y)/2,z:(n.z+o.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(let t=0;t<this.centers.length-1;t++){const n=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,o=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,a=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+n),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+a)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+n),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}cacheSteps(s){const t=[];let n=this.pos(0);t.push(0);for(let o=0;o<this.duration;o+=10){const a=this.pos(o);Math.sqrt((a.x-n.x)*(a.x-n.x)+(a.y-n.y)*(a.y-n.y)+(a.z-n.z)*(a.z-n.z))>s&&(t.push(o),n=a)}return t}vector(s){const t=this.pos(s+10),n=this.pos(s-10);return{angle:180*Math.atan2(t.y-n.y,t.x-n.x)/3.14,speed:Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)+(n.z-t.z)*(n.z-t.z))}}pos(s){let t=s-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);const n=t/this.duration;if(n>=1)return this.points[this.length-1];const o=Math.floor((this.points.length-1)*n),a=(this.length-1)*n-o;return q(a,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])}};function q(s,t,n,o,a){const e=N(s);return{x:a.x*e[0]+o.x*e[1]+n.x*e[2]+t.x*e[3],y:a.y*e[0]+o.y*e[1]+n.y*e[2]+t.y*e[3],z:a.z*e[0]+o.z*e[1]+n.z*e[2]+t.z*e[3]}}function N(s){const t=s*s;return[t*s,3*t*(1-s),3*s*(1-s)*(1-s),(1-s)*(1-s)*(1-s)]}function A(s,t={}){const n=t.resolution||1e4,o=t.sharpness||.85,a=[],e=_(s).coordinates.map(p=>({x:p[0],y:p[1]})),r=new F({duration:n,points:e,sharpness:o}),i=p=>{var u=r.pos(p);Math.floor(p/100)%2===0&&a.push([u.x,u.y])};for(var h=0;h<r.duration;h+=10)i(h);return i(r.duration),z(a,t.properties)}var G=A;function D(s){return C({queryKey:["polylineFromRoute",s==null?void 0:s.id],queryFn:()=>{if(!(s!=null&&s.segments)||s.segments.length===0)return[];try{const t=s.segments.map(r=>{const i=s.stops.find(h=>h.id==r.start_stop_id);return{...r,order_index:i==null?void 0:i.order_index}}).sort((r,i)=>(r.order_index||0)-(i.order_index||0)),n=[];for(const r of t){let i=[];if(typeof r.geometry=="string")try{i=L.decode(r.geometry)}catch(h){console.warn("Failed to decode polyline segment:",h)}else r.geometry&&r.geometry.type==="LineString"&&Array.isArray(r.geometry.coordinates)&&(i=r.geometry.coordinates.map(([h,p])=>[p,h]));i.length>0&&(n.length===0?n.push(...i):n.push(...i.slice(1)))}const o=z(n.map(([r,i])=>[i,r]));return G(o,{resolution:5e4,sharpness:.5}).geometry.coordinates.map(([r,i])=>[i,r])}catch(t){return console.error("Failed to parse route segments into polyline:",t),[]}},enabled:!!(s!=null&&s.segments),initialData:[]}).data}function H(s,[t,n]){return Math.min(n,Math.max(t,s))}export{D as a,R as b,H as c,b as u};

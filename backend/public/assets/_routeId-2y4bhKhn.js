import{c as Z,r as a,j as e,P as D,x as $e,e as Tt,q as Be,y as _t,f as Rt,z as Le,Q as Pt,d as W,A as Et,h as M,k as X,C as kt,T as We,i as Mt,E as At,H as Dt,F as Lt,G as Ot,I as Bt,J as Vt,K as Ft,M as Ht,b as ie,B as oe,t as K,p as Ke,L as Ve,U as zt,D as Ut}from"./index-28yYTQYt.js";import{I as Pe,a as $t}from"./loading-button-BkylZ5sb.js";import{c as qe,u as Ge,b as Ye,X as Wt}from"./index.esm-Bnp_jBhY.js";import{C as Fe,b as He,c as ze,a as _e}from"./card-Da7qCGoe.js";import{c as Ue,a as Kt,b as qt}from"./index-xtoGandZ.js";import{u as Gt,T as Yt}from"./index-BH9_JX7X.js";import{C as Xt,N as Zt,L as Jt}from"./location-search-CVZT0ayL.js";import{n as Xe,o as Ze,p as Qt,i as eo,q as to,r as oo}from"./useVacationGalleryApi-CYdJb4Ya.js";import{F as Je,a as ue,b as pe,d as me,e as fe,c as Re}from"./form-DdwsN0VQ.js";import{O as no,M as ro}from"./openstreetmap-C_Emiqu9.js";import{ar as ve,a6 as Qe,aF as q,aq as ae,X as so,aN as ao}from"./types-BJIYILio.js";import{P as io}from"./Polyline-ByBcXFxq.js";import"./useQuery-fXf16oON.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],co=Z("arrow-down",lo);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],po=Z("arrow-left",uo);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],fo=Z("arrow-up",mo);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ho=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],go=Z("chevron-up",ho);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=[["path",{d:"m17 15-5.5 5.5L9 18",key:"15q87x"}],["path",{d:"M5 17.743A7 7 0 1 1 15.71 10h1.79a4.5 4.5 0 0 1 1.5 8.742",key:"9ho6ki"}]],vo=Z("cloud-check",xo);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],wo=Z("cloud-off",So);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],bo=Z("save",yo);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],jo=Z("target",Co),No=ve({title:q().min(1,"Stop title is required"),description:q().optional(),latitude:ae().min(-90).max(90),longitude:ae().min(-180).max(180),order_index:ae().int().min(0)});ve({trip_id:q().uuid("Valid trip ID is required"),title:q().min(1,"Route title is required"),description:q().optional(),profile:Qe(["driving-car","driving-hgv","cycling-regular","cycling-road","cycling-mountain","cycling-electric","foot-walking","foot-hiking","wheelchair"]).default("driving-car"),stops:so(No)});const Io=ve({title:q().min(1).optional(),description:q().optional(),profile:Qe(["driving-car","driving-hgv","cycling-regular","cycling-road","cycling-mountain","cycling-electric","foot-walking","foot-hiking","wheelchair"]).optional()});ve({title:q().min(1).optional(),description:q().optional(),latitude:ae().min(-90).max(90).optional(),longitude:ae().min(-180).max(180).optional(),order_index:ae().int().min(0).optional()});var et=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),To="VisuallyHidden",_o=a.forwardRef((o,r)=>e.jsx(D.span,{...o,ref:r,style:{...et,...o.style}}));_o.displayName=To;var Ro=[" ","Enter","ArrowUp","ArrowDown"],Po=[" ","Enter"],ne="Select",[Se,we,Eo]=Pt(ne),[le,Dn]=Rt(ne,[Eo,$e]),ye=$e(),[ko,J]=le(ne),[Mo,Ao]=le(ne),tt=o=>{const{__scopeSelect:r,children:t,open:c,defaultOpen:d,onOpenChange:m,value:n,defaultValue:s,onValueChange:i,dir:u,name:S,autoComplete:y,disabled:j,required:v,form:C}=o,p=ye(r),[w,N]=a.useState(null),[f,g]=a.useState(null),[L,O]=a.useState(!1),G=Tt(u),[A,V]=Be({prop:c,defaultProp:d??!1,onChange:m,caller:ne}),[F,$]=Be({prop:n,defaultProp:s,onChange:i,caller:ne}),l=a.useRef(null),h=w?C||!!w.closest("form"):!0,[b,R]=a.useState(new Set),H=Array.from(b).map(k=>k.props.value).join(";");return e.jsx(_t,{...p,children:e.jsxs(ko,{required:v,scope:r,trigger:w,onTriggerChange:N,valueNode:f,onValueNodeChange:g,valueNodeHasChildren:L,onValueNodeHasChildrenChange:O,contentId:Le(),value:F,onValueChange:$,open:A,onOpenChange:V,dir:G,triggerPointerDownPosRef:l,disabled:j,children:[e.jsx(Se.Provider,{scope:r,children:e.jsx(Mo,{scope:o.__scopeSelect,onNativeOptionAdd:a.useCallback(k=>{R(E=>new Set(E).add(k))},[]),onNativeOptionRemove:a.useCallback(k=>{R(E=>{const z=new Set(E);return z.delete(k),z})},[]),children:t})}),h?e.jsxs(Ct,{"aria-hidden":!0,required:v,tabIndex:-1,name:S,autoComplete:y,value:F,onChange:k=>$(k.target.value),disabled:j,form:C,children:[F===void 0?e.jsx("option",{value:""}):null,Array.from(b)]},H):null]})})};tt.displayName=ne;var ot="SelectTrigger",nt=a.forwardRef((o,r)=>{const{__scopeSelect:t,disabled:c=!1,...d}=o,m=ye(t),n=J(ot,t),s=n.disabled||c,i=W(r,n.onTriggerChange),u=we(t),S=a.useRef("touch"),[y,j,v]=Nt(p=>{const w=u().filter(g=>!g.disabled),N=w.find(g=>g.value===n.value),f=It(w,p,N);f!==void 0&&n.onValueChange(f.value)}),C=p=>{s||(n.onOpenChange(!0),v()),p&&(n.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return e.jsx(Et,{asChild:!0,...m,children:e.jsx(D.button,{type:"button",role:"combobox","aria-controls":n.contentId,"aria-expanded":n.open,"aria-required":n.required,"aria-autocomplete":"none",dir:n.dir,"data-state":n.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":jt(n.value)?"":void 0,...d,ref:i,onClick:M(d.onClick,p=>{p.currentTarget.focus(),S.current!=="mouse"&&C(p)}),onPointerDown:M(d.onPointerDown,p=>{S.current=p.pointerType;const w=p.target;w.hasPointerCapture(p.pointerId)&&w.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(C(p),p.preventDefault())}),onKeyDown:M(d.onKeyDown,p=>{const w=y.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&j(p.key),!(w&&p.key===" ")&&Ro.includes(p.key)&&(C(),p.preventDefault())})})})});nt.displayName=ot;var rt="SelectValue",st=a.forwardRef((o,r)=>{const{__scopeSelect:t,className:c,style:d,children:m,placeholder:n="",...s}=o,i=J(rt,t),{onValueNodeHasChildrenChange:u}=i,S=m!==void 0,y=W(r,i.onValueNodeChange);return X(()=>{u(S)},[u,S]),e.jsx(D.span,{...s,ref:y,style:{pointerEvents:"none"},children:jt(i.value)?e.jsx(e.Fragment,{children:n}):m})});st.displayName=rt;var Do="SelectIcon",at=a.forwardRef((o,r)=>{const{__scopeSelect:t,children:c,...d}=o;return e.jsx(D.span,{"aria-hidden":!0,...d,ref:r,children:c||"▼"})});at.displayName=Do;var Lo="SelectPortal",it=o=>e.jsx(kt,{asChild:!0,...o});it.displayName=Lo;var re="SelectContent",lt=a.forwardRef((o,r)=>{const t=J(re,o.__scopeSelect),[c,d]=a.useState();if(X(()=>{d(new DocumentFragment)},[]),!t.open){const m=c;return m?We.createPortal(e.jsx(ct,{scope:o.__scopeSelect,children:e.jsx(Se.Slot,{scope:o.__scopeSelect,children:e.jsx("div",{children:o.children})})}),m):null}return e.jsx(dt,{...o,ref:r})});lt.displayName=re;var U=10,[ct,Q]=le(re),Oo="SelectContentImpl",Bo=Ot("SelectContent.RemoveScroll"),dt=a.forwardRef((o,r)=>{const{__scopeSelect:t,position:c="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:m,onPointerDownOutside:n,side:s,sideOffset:i,align:u,alignOffset:S,arrowPadding:y,collisionBoundary:j,collisionPadding:v,sticky:C,hideWhenDetached:p,avoidCollisions:w,...N}=o,f=J(re,t),[g,L]=a.useState(null),[O,G]=a.useState(null),A=W(r,x=>L(x)),[V,F]=a.useState(null),[$,l]=a.useState(null),h=we(t),[b,R]=a.useState(!1),H=a.useRef(!1);a.useEffect(()=>{if(g)return At(g)},[g]),Dt();const k=a.useCallback(x=>{const[P,...B]=h().map(T=>T.ref.current),[_]=B.slice(-1),I=document.activeElement;for(const T of x)if(T===I||(T==null||T.scrollIntoView({block:"nearest"}),T===P&&O&&(O.scrollTop=0),T===_&&O&&(O.scrollTop=O.scrollHeight),T==null||T.focus(),document.activeElement!==I))return},[h,O]),E=a.useCallback(()=>k([V,g]),[k,V,g]);a.useEffect(()=>{b&&E()},[b,E]);const{onOpenChange:z,triggerPointerDownPosRef:Y}=f;a.useEffect(()=>{if(g){let x={x:0,y:0};const P=_=>{var I,T;x={x:Math.abs(Math.round(_.pageX)-(((I=Y.current)==null?void 0:I.x)??0)),y:Math.abs(Math.round(_.pageY)-(((T=Y.current)==null?void 0:T.y)??0))}},B=_=>{x.x<=10&&x.y<=10?_.preventDefault():g.contains(_.target)||z(!1),document.removeEventListener("pointermove",P),Y.current=null};return Y.current!==null&&(document.addEventListener("pointermove",P),document.addEventListener("pointerup",B,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",P),document.removeEventListener("pointerup",B,{capture:!0})}}},[g,z,Y]),a.useEffect(()=>{const x=()=>z(!1);return window.addEventListener("blur",x),window.addEventListener("resize",x),()=>{window.removeEventListener("blur",x),window.removeEventListener("resize",x)}},[z]);const[be,he]=Nt(x=>{const P=h().filter(I=>!I.disabled),B=P.find(I=>I.ref.current===document.activeElement),_=It(P,x,B);_&&setTimeout(()=>_.ref.current.focus())}),Ce=a.useCallback((x,P,B)=>{const _=!H.current&&!B;(f.value!==void 0&&f.value===P||_)&&(F(x),_&&(H.current=!0))},[f.value]),je=a.useCallback(()=>g==null?void 0:g.focus(),[g]),se=a.useCallback((x,P,B)=>{const _=!H.current&&!B;(f.value!==void 0&&f.value===P||_)&&l(x)},[f.value]),ge=c==="popper"?Ee:ut,ce=ge===Ee?{side:s,sideOffset:i,align:u,alignOffset:S,arrowPadding:y,collisionBoundary:j,collisionPadding:v,sticky:C,hideWhenDetached:p,avoidCollisions:w}:{};return e.jsx(ct,{scope:t,content:g,viewport:O,onViewportChange:G,itemRefCallback:Ce,selectedItem:V,onItemLeave:je,itemTextRefCallback:se,focusSelectedItem:E,selectedItemText:$,position:c,isPositioned:b,searchRef:be,children:e.jsx(Lt,{as:Bo,allowPinchZoom:!0,children:e.jsx(Bt,{asChild:!0,trapped:f.open,onMountAutoFocus:x=>{x.preventDefault()},onUnmountAutoFocus:M(d,x=>{var P;(P=f.trigger)==null||P.focus({preventScroll:!0}),x.preventDefault()}),children:e.jsx(Vt,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:m,onPointerDownOutside:n,onFocusOutside:x=>x.preventDefault(),onDismiss:()=>f.onOpenChange(!1),children:e.jsx(ge,{role:"listbox",id:f.contentId,"data-state":f.open?"open":"closed",dir:f.dir,onContextMenu:x=>x.preventDefault(),...N,...ce,onPlaced:()=>R(!0),ref:A,style:{display:"flex",flexDirection:"column",outline:"none",...N.style},onKeyDown:M(N.onKeyDown,x=>{const P=x.ctrlKey||x.altKey||x.metaKey;if(x.key==="Tab"&&x.preventDefault(),!P&&x.key.length===1&&he(x.key),["ArrowUp","ArrowDown","Home","End"].includes(x.key)){let _=h().filter(I=>!I.disabled).map(I=>I.ref.current);if(["ArrowUp","End"].includes(x.key)&&(_=_.slice().reverse()),["ArrowUp","ArrowDown"].includes(x.key)){const I=x.target,T=_.indexOf(I);_=_.slice(T+1)}setTimeout(()=>k(_)),x.preventDefault()}})})})})})})});dt.displayName=Oo;var Vo="SelectItemAlignedPosition",ut=a.forwardRef((o,r)=>{const{__scopeSelect:t,onPlaced:c,...d}=o,m=J(re,t),n=Q(re,t),[s,i]=a.useState(null),[u,S]=a.useState(null),y=W(r,A=>S(A)),j=we(t),v=a.useRef(!1),C=a.useRef(!0),{viewport:p,selectedItem:w,selectedItemText:N,focusSelectedItem:f}=n,g=a.useCallback(()=>{if(m.trigger&&m.valueNode&&s&&u&&p&&w&&N){const A=m.trigger.getBoundingClientRect(),V=u.getBoundingClientRect(),F=m.valueNode.getBoundingClientRect(),$=N.getBoundingClientRect();if(m.dir!=="rtl"){const I=$.left-V.left,T=F.left-I,ee=A.left-T,te=A.width+ee,Ne=Math.max(te,V.width),Ie=window.innerWidth-U,Te=Ue(T,[U,Math.max(U,Ie-Ne)]);s.style.minWidth=te+"px",s.style.left=Te+"px"}else{const I=V.right-$.right,T=window.innerWidth-F.right-I,ee=window.innerWidth-A.right-T,te=A.width+ee,Ne=Math.max(te,V.width),Ie=window.innerWidth-U,Te=Ue(T,[U,Math.max(U,Ie-Ne)]);s.style.minWidth=te+"px",s.style.right=Te+"px"}const l=j(),h=window.innerHeight-U*2,b=p.scrollHeight,R=window.getComputedStyle(u),H=parseInt(R.borderTopWidth,10),k=parseInt(R.paddingTop,10),E=parseInt(R.borderBottomWidth,10),z=parseInt(R.paddingBottom,10),Y=H+k+b+z+E,be=Math.min(w.offsetHeight*5,Y),he=window.getComputedStyle(p),Ce=parseInt(he.paddingTop,10),je=parseInt(he.paddingBottom,10),se=A.top+A.height/2-U,ge=h-se,ce=w.offsetHeight/2,x=w.offsetTop+ce,P=H+k+x,B=Y-P;if(P<=se){const I=l.length>0&&w===l[l.length-1].ref.current;s.style.bottom="0px";const T=u.clientHeight-p.offsetTop-p.offsetHeight,ee=Math.max(ge,ce+(I?je:0)+T+E),te=P+ee;s.style.height=te+"px"}else{const I=l.length>0&&w===l[0].ref.current;s.style.top="0px";const ee=Math.max(se,H+p.offsetTop+(I?Ce:0)+ce)+B;s.style.height=ee+"px",p.scrollTop=P-se+p.offsetTop}s.style.margin=`${U}px 0`,s.style.minHeight=be+"px",s.style.maxHeight=h+"px",c==null||c(),requestAnimationFrame(()=>v.current=!0)}},[j,m.trigger,m.valueNode,s,u,p,w,N,m.dir,c]);X(()=>g(),[g]);const[L,O]=a.useState();X(()=>{u&&O(window.getComputedStyle(u).zIndex)},[u]);const G=a.useCallback(A=>{A&&C.current===!0&&(g(),f==null||f(),C.current=!1)},[g,f]);return e.jsx(Ho,{scope:t,contentWrapper:s,shouldExpandOnScrollRef:v,onScrollButtonChange:G,children:e.jsx("div",{ref:i,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:L},children:e.jsx(D.div,{...d,ref:y,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});ut.displayName=Vo;var Fo="SelectPopperPosition",Ee=a.forwardRef((o,r)=>{const{__scopeSelect:t,align:c="start",collisionPadding:d=U,...m}=o,n=ye(t);return e.jsx(Ft,{...n,...m,ref:r,align:c,collisionPadding:d,style:{boxSizing:"border-box",...m.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ee.displayName=Fo;var[Ho,Oe]=le(re,{}),ke="SelectViewport",pt=a.forwardRef((o,r)=>{const{__scopeSelect:t,nonce:c,...d}=o,m=Q(ke,t),n=Oe(ke,t),s=W(r,m.onViewportChange),i=a.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),e.jsx(Se.Slot,{scope:t,children:e.jsx(D.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:M(d.onScroll,u=>{const S=u.currentTarget,{contentWrapper:y,shouldExpandOnScrollRef:j}=n;if(j!=null&&j.current&&y){const v=Math.abs(i.current-S.scrollTop);if(v>0){const C=window.innerHeight-U*2,p=parseFloat(y.style.minHeight),w=parseFloat(y.style.height),N=Math.max(p,w);if(N<C){const f=N+v,g=Math.min(C,f),L=f-g;y.style.height=g+"px",y.style.bottom==="0px"&&(S.scrollTop=L>0?L:0,y.style.justifyContent="flex-end")}}}i.current=S.scrollTop})})})]})});pt.displayName=ke;var mt="SelectGroup",[zo,Uo]=le(mt),$o=a.forwardRef((o,r)=>{const{__scopeSelect:t,...c}=o,d=Le();return e.jsx(zo,{scope:t,id:d,children:e.jsx(D.div,{role:"group","aria-labelledby":d,...c,ref:r})})});$o.displayName=mt;var ft="SelectLabel",Wo=a.forwardRef((o,r)=>{const{__scopeSelect:t,...c}=o,d=Uo(ft,t);return e.jsx(D.div,{id:d.id,...c,ref:r})});Wo.displayName=ft;var xe="SelectItem",[Ko,ht]=le(xe),gt=a.forwardRef((o,r)=>{const{__scopeSelect:t,value:c,disabled:d=!1,textValue:m,...n}=o,s=J(xe,t),i=Q(xe,t),u=s.value===c,[S,y]=a.useState(m??""),[j,v]=a.useState(!1),C=W(r,f=>{var g;return(g=i.itemRefCallback)==null?void 0:g.call(i,f,c,d)}),p=Le(),w=a.useRef("touch"),N=()=>{d||(s.onValueChange(c),s.onOpenChange(!1))};if(c==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(Ko,{scope:t,value:c,disabled:d,textId:p,isSelected:u,onItemTextChange:a.useCallback(f=>{y(g=>g||((f==null?void 0:f.textContent)??"").trim())},[]),children:e.jsx(Se.ItemSlot,{scope:t,value:c,disabled:d,textValue:S,children:e.jsx(D.div,{role:"option","aria-labelledby":p,"data-highlighted":j?"":void 0,"aria-selected":u&&j,"data-state":u?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,...n,ref:C,onFocus:M(n.onFocus,()=>v(!0)),onBlur:M(n.onBlur,()=>v(!1)),onClick:M(n.onClick,()=>{w.current!=="mouse"&&N()}),onPointerUp:M(n.onPointerUp,()=>{w.current==="mouse"&&N()}),onPointerDown:M(n.onPointerDown,f=>{w.current=f.pointerType}),onPointerMove:M(n.onPointerMove,f=>{var g;w.current=f.pointerType,d?(g=i.onItemLeave)==null||g.call(i):w.current==="mouse"&&f.currentTarget.focus({preventScroll:!0})}),onPointerLeave:M(n.onPointerLeave,f=>{var g;f.currentTarget===document.activeElement&&((g=i.onItemLeave)==null||g.call(i))}),onKeyDown:M(n.onKeyDown,f=>{var L;((L=i.searchRef)==null?void 0:L.current)!==""&&f.key===" "||(Po.includes(f.key)&&N(),f.key===" "&&f.preventDefault())})})})})});gt.displayName=xe;var de="SelectItemText",xt=a.forwardRef((o,r)=>{const{__scopeSelect:t,className:c,style:d,...m}=o,n=J(de,t),s=Q(de,t),i=ht(de,t),u=Ao(de,t),[S,y]=a.useState(null),j=W(r,N=>y(N),i.onItemTextChange,N=>{var f;return(f=s.itemTextRefCallback)==null?void 0:f.call(s,N,i.value,i.disabled)}),v=S==null?void 0:S.textContent,C=a.useMemo(()=>e.jsx("option",{value:i.value,disabled:i.disabled,children:v},i.value),[i.disabled,i.value,v]),{onNativeOptionAdd:p,onNativeOptionRemove:w}=u;return X(()=>(p(C),()=>w(C)),[p,w,C]),e.jsxs(e.Fragment,{children:[e.jsx(D.span,{id:i.textId,...m,ref:j}),i.isSelected&&n.valueNode&&!n.valueNodeHasChildren?We.createPortal(m.children,n.valueNode):null]})});xt.displayName=de;var vt="SelectItemIndicator",St=a.forwardRef((o,r)=>{const{__scopeSelect:t,...c}=o;return ht(vt,t).isSelected?e.jsx(D.span,{"aria-hidden":!0,...c,ref:r}):null});St.displayName=vt;var Me="SelectScrollUpButton",wt=a.forwardRef((o,r)=>{const t=Q(Me,o.__scopeSelect),c=Oe(Me,o.__scopeSelect),[d,m]=a.useState(!1),n=W(r,c.onScrollButtonChange);return X(()=>{if(t.viewport&&t.isPositioned){let s=function(){const u=i.scrollTop>0;m(u)};const i=t.viewport;return s(),i.addEventListener("scroll",s),()=>i.removeEventListener("scroll",s)}},[t.viewport,t.isPositioned]),d?e.jsx(bt,{...o,ref:n,onAutoScroll:()=>{const{viewport:s,selectedItem:i}=t;s&&i&&(s.scrollTop=s.scrollTop-i.offsetHeight)}}):null});wt.displayName=Me;var Ae="SelectScrollDownButton",yt=a.forwardRef((o,r)=>{const t=Q(Ae,o.__scopeSelect),c=Oe(Ae,o.__scopeSelect),[d,m]=a.useState(!1),n=W(r,c.onScrollButtonChange);return X(()=>{if(t.viewport&&t.isPositioned){let s=function(){const u=i.scrollHeight-i.clientHeight,S=Math.ceil(i.scrollTop)<u;m(S)};const i=t.viewport;return s(),i.addEventListener("scroll",s),()=>i.removeEventListener("scroll",s)}},[t.viewport,t.isPositioned]),d?e.jsx(bt,{...o,ref:n,onAutoScroll:()=>{const{viewport:s,selectedItem:i}=t;s&&i&&(s.scrollTop=s.scrollTop+i.offsetHeight)}}):null});yt.displayName=Ae;var bt=a.forwardRef((o,r)=>{const{__scopeSelect:t,onAutoScroll:c,...d}=o,m=Q("SelectScrollButton",t),n=a.useRef(null),s=we(t),i=a.useCallback(()=>{n.current!==null&&(window.clearInterval(n.current),n.current=null)},[]);return a.useEffect(()=>()=>i(),[i]),X(()=>{var S;const u=s().find(y=>y.ref.current===document.activeElement);(S=u==null?void 0:u.ref.current)==null||S.scrollIntoView({block:"nearest"})},[s]),e.jsx(D.div,{"aria-hidden":!0,...d,ref:r,style:{flexShrink:0,...d.style},onPointerDown:M(d.onPointerDown,()=>{n.current===null&&(n.current=window.setInterval(c,50))}),onPointerMove:M(d.onPointerMove,()=>{var u;(u=m.onItemLeave)==null||u.call(m),n.current===null&&(n.current=window.setInterval(c,50))}),onPointerLeave:M(d.onPointerLeave,()=>{i()})})}),qo="SelectSeparator",Go=a.forwardRef((o,r)=>{const{__scopeSelect:t,...c}=o;return e.jsx(D.div,{"aria-hidden":!0,...c,ref:r})});Go.displayName=qo;var De="SelectArrow",Yo=a.forwardRef((o,r)=>{const{__scopeSelect:t,...c}=o,d=ye(t),m=J(De,t),n=Q(De,t);return m.open&&n.position==="popper"?e.jsx(Ht,{...d,...c,ref:r}):null});Yo.displayName=De;var Xo="SelectBubbleInput",Ct=a.forwardRef(({__scopeSelect:o,value:r,...t},c)=>{const d=a.useRef(null),m=W(c,d),n=Gt(r);return a.useEffect(()=>{const s=d.current;if(!s)return;const i=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(i,"value").set;if(n!==r&&S){const y=new Event("change",{bubbles:!0});S.call(s,r),s.dispatchEvent(y)}},[n,r]),e.jsx(D.select,{...t,style:{...et,...t.style},ref:m,defaultValue:r})});Ct.displayName=Xo;function jt(o){return o===""||o===void 0}function Nt(o){const r=Mt(o),t=a.useRef(""),c=a.useRef(0),d=a.useCallback(n=>{const s=t.current+n;r(s),function i(u){t.current=u,window.clearTimeout(c.current),u!==""&&(c.current=window.setTimeout(()=>i(""),1e3))}(s)},[r]),m=a.useCallback(()=>{t.current="",window.clearTimeout(c.current)},[]);return a.useEffect(()=>()=>window.clearTimeout(c.current),[]),[t,d,m]}function It(o,r,t){const d=r.length>1&&Array.from(r).every(u=>u===r[0])?r[0]:r,m=t?o.indexOf(t):-1;let n=Zo(o,Math.max(m,0));d.length===1&&(n=n.filter(u=>u!==t));const i=n.find(u=>u.textValue.toLowerCase().startsWith(d.toLowerCase()));return i!==t?i:void 0}function Zo(o,r){return o.map((t,c)=>o[(r+c)%o.length])}var Jo=tt,Qo=nt,en=st,tn=at,on=it,nn=lt,rn=pt,sn=gt,an=xt,ln=St,cn=wt,dn=yt;function un({...o}){return e.jsx(Jo,{"data-slot":"select",...o})}function pn({...o}){return e.jsx(en,{"data-slot":"select-value",...o})}function mn({className:o,size:r="default",children:t,...c}){return e.jsxs(Qo,{"data-slot":"select-trigger","data-size":r,className:ie("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...c,children:[t,e.jsx(tn,{asChild:!0,children:e.jsx(qe,{className:"size-4 opacity-50"})})]})}function fn({className:o,children:r,position:t="popper",...c}){return e.jsx(on,{children:e.jsxs(nn,{"data-slot":"select-content",className:ie("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",o),position:t,...c,children:[e.jsx(gn,{}),e.jsx(rn,{className:ie("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:r}),e.jsx(xn,{})]})})}function hn({className:o,children:r,...t}){return e.jsxs(sn,{"data-slot":"select-item",className:ie("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",o),...t,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ln,{children:e.jsx(Xt,{className:"size-4"})})}),e.jsx(an,{children:r})]})}function gn({className:o,...r}){return e.jsx(cn,{"data-slot":"select-scroll-up-button",className:ie("flex cursor-default items-center justify-center py-1",o),...r,children:e.jsx(go,{className:"size-4"})})}function xn({className:o,...r}){return e.jsx(dn,{"data-slot":"select-scroll-down-button",className:ie("flex cursor-default items-center justify-center py-1",o),...r,children:e.jsx(qe,{className:"size-4"})})}function vn({stop:o,moveStop:r,totalStops:t,onNavigateClicked:c}){const d=a.useRef(null),m=Xe(),n=Ze(),s=v=>({title:v.title,description:v.description||""}),i=Ge({defaultValues:s(o),shouldFocusError:!1,reValidateMode:"onChange",resolver:ao(Io)}),{reset:u,formState:{isDirty:S}}=i;a.useEffect(()=>{u(s(o))},[o]);const y=async v=>{try{await m.mutateAsync({routeId:o.route_id,stopId:o.id,data:v})}catch(C){K.error("Failed to update stop"),console.error("Error updating stop:",C)}},j=()=>{d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{i.handleSubmit(y)()},500)};return e.jsx(Je,{...i,children:e.jsx("div",{className:"p-3 border bg-accent rounded-md h-26 flex",children:e.jsxs("div",{className:"flex gap-2 h-full grow",children:[e.jsx(oe,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer h-full!",onClick:c,type:"button",children:o.order_index}),e.jsxs("div",{className:"flex-1 min-w-0 gap-2 flex-col flex",children:[e.jsx(ue,{control:i.control,name:"title",render:({field:v})=>e.jsxs(pe,{className:"h-full",children:[e.jsx(me,{children:e.jsx(Pe,{...v,onBlur:()=>{j(),v.onBlur()},onChange:C=>{v.onChange(C),j()},className:"h-full text-sm",onFocus:j,placeholder:"Stop name..."})}),e.jsx(fe,{})]})}),e.jsx(Pe,{className:"text-xs! h-6! max-w-md",disabled:!0,value:`${o.latitude.toFixed(4)}, ${o.longitude.toFixed(4)}`})]}),e.jsx(ue,{control:i.control,name:"description",render:({field:v})=>e.jsxs(pe,{className:"flex-1",children:[e.jsx(me,{children:e.jsx(Ye,{...v,onBlur:()=>{j(),v.onBlur()},onChange:C=>{v.onChange(C),j()},onFocus:j,placeholder:"No description (yet)",className:"text-xs h-full resize-none"})}),e.jsx(fe,{})]})}),e.jsxs("div",{className:"flex flex-col justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(oe,{variant:"ghost",size:"sm",type:"button",onClick:v=>{v.stopPropagation(),r("up")},disabled:o.order_index===0,className:"h-6 w-6 p-0",children:e.jsx(fo,{className:"h-3 w-3"})}),e.jsx(oe,{variant:"ghost",size:"sm",type:"button",onClick:v=>{v.stopPropagation(),r("down")},disabled:o.order_index===t-1,className:"h-6 w-6 p-0",children:e.jsx(co,{className:"h-3 w-3"})}),e.jsx(oe,{variant:"ghost",size:"sm",type:"button",onClick:v=>{v.stopPropagation(),n.mutateAsync({routeId:o.route_id,stopId:o.id})},className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",children:e.jsx(Wt,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex justify-end",children:[S&&e.jsx(wo,{className:"text-orange-600"}),!S&&e.jsx(vo,{className:"text-green-600"})]})]})]})})})}const Sn=[{value:"driving-car",label:"Car",icon:"🚗"},{value:"driving-hgv",label:"Truck",icon:"🚛"},{value:"cycling-regular",label:"Bike",icon:"🚴"},{value:"cycling-road",label:"Road Bike",icon:"🚴‍♀️"},{value:"cycling-mountain",label:"Mountain Bike",icon:"🚵"},{value:"cycling-electric",label:"E-Bike",icon:"🚴‍♂️"},{value:"foot-walking",label:"Walking",icon:"🚶"},{value:"foot-hiking",label:"Hiking",icon:"🥾"},{value:"wheelchair",label:"Wheelchair",icon:"♿"}];function wn({route:o}){var $;const r=Qt(),t=Xe(),c=Ze(),d=eo(),m=Ke(),n=a.useMemo(()=>{if(t.isSuccess)return t.data;if(!o)return;const l=new Date().toISOString(),h=r.isPending&&[{...r.variables.data,created_at:l,updated_at:l,route_id:o.id,id:"new-stop"}]||[],b=c.isPending?c.variables.stopId:void 0,R=t.isPending&&(t.variables.data.latitude!==void 0||t.variables.data.longitude!==void 0),H=[...o.stops,...h].slice().filter(E=>E.id!==b).sort((E,z)=>E.order_index-z.order_index).map(E=>t.isPending&&t.variables.stopId===E.id?{...E,...t.variables.data}:E),k={...o,stops:H};return R&&(k.segments=[]),k},[o,r.variables,r.isPending,t.variables,t.isPending,t.isSuccess,t.data,c.variables,c.isPending]),s=(n==null?void 0:n.stops)||[],i=a.useRef(null),u=l=>({title:(l==null?void 0:l.title)||"",description:(l==null?void 0:l.description)||"",profile:(l==null?void 0:l.profile)||"driving-car"}),S=Ge({defaultValues:n&&u(n)}),{reset:y,handleSubmit:j,formState:{isValid:v,isDirty:C}}=S;a.useEffect(()=>{n&&y(u(n))},[n]),a.useEffect(()=>{y({title:(n==null?void 0:n.title)||"",description:(n==null?void 0:n.description)||"",profile:(n==null?void 0:n.profile)||"driving-car"})},[n,y]);const p=a.useMemo(()=>{var l;return(l=s.find(h=>t.isPending&&t.variables.stopId===h.id||r.isPending&&r.variables.data.title===h.title))==null?void 0:l.id},[t.isPending,($=t.variables)==null?void 0:$.stopId,s]);a.useEffect(()=>{if(!i.current)return;const l=s.filter(h=>h.latitude!==0&&h.longitude!==0);if(l.length>1){const h=Ve.latLngBounds(l.map(b=>[b.latitude,b.longitude]));i.current.fitBounds(h,{padding:[20,20]})}else l.length===1&&i.current.setView([l[0].latitude,l[0].longitude],15)},[s,n,i.current]);const w=async l=>{var b;const h={title:l.display_name.split(",")[0],description:l.display_name,latitude:parseFloat(l.lat),longitude:parseFloat(l.lon),order_index:s.length};try{(b=i.current)==null||b.setView([h.latitude,h.longitude],15),await r.mutateAsync({routeId:o.id,data:h}),K.success(`Added stop: ${h.title}`)}catch(R){K.error("Failed to add stop"),console.error("Error creating stop:",R)}},N=async(l,h)=>{const b={title:`Stop ${s.length+1}`,description:"",latitude:l,longitude:h,order_index:s.length};try{await r.mutateAsync({routeId:o.id,data:b}),K.success("Stop added and route updated")}catch(R){K.error("Failed to add stop"),console.error("Error creating stop:",R)}},f=async(l,h)=>{const b=s.at(l);if(!n||!b)return;const R=h==="up"?l-1:l+1;R<0||R>=s.length||await t.mutateAsync({routeId:n.id,stopId:b.id,data:{...b,order_index:R}})},g=to(),{isPending:L}=g,O=async l=>{n&&g.mutateAsync({id:n.id,data:l}).then(()=>K.success("Route has been saved")).catch(h=>K.error("Error saving route",{description:h.toString()}))},G=()=>{n&&m({to:"/admin/$tripId",params:{tripId:n.trip_id}})},A=async()=>{if(n&&confirm("Are you sure you want to delete this route? This action cannot be undone."))try{await d.mutateAsync(n.id),K.success("Route deleted successfully"),G()}catch(l){const h=l instanceof Error?l.message:"Failed to delete route";K.error(h)}};function V(){return qt({click:l=>{N(l.latlng.lat,l.latlng.lng)}}),null}const F=Kt(n);return e.jsx(Je,{...S,children:e.jsx("form",{onSubmit:j(O),children:e.jsxs("div",{className:"space-y-4 grid grid-cols-1 lg:grid-cols-2 w-full gap-4",children:[e.jsxs(Fe,{className:"h-full",children:[e.jsx(He,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Zt,{className:"h-5 w-5"}),"Edit Route"]})}),e.jsxs(_e,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ue,{control:S.control,name:"title",render:({field:l})=>e.jsxs(pe,{children:[e.jsx(Re,{children:"Route Title *"}),e.jsx(me,{children:e.jsx(Pe,{...l,className:"input",placeholder:"Enter route title..."})}),e.jsx(fe,{})]})}),e.jsx(ue,{control:S.control,name:"profile",render:({field:l})=>e.jsxs(pe,{children:[e.jsx(Re,{children:"Profile *"}),e.jsx(me,{children:e.jsxs(un,{...l,value:l.value,onValueChange:h=>l.onChange(h),children:[e.jsx(mn,{children:e.jsx(pn,{placeholder:"Select transportation mode"})}),e.jsx(fn,{children:Sn.map(h=>e.jsxs(hn,{value:h.value,children:[h.icon," ",h.label]},h.value))})]})}),e.jsx(fe,{})]})})]}),e.jsx(ue,{control:S.control,name:"description",render:({field:l})=>e.jsxs(pe,{children:[e.jsx(Re,{children:"Route description"}),e.jsx(me,{children:e.jsx(Ye,{...l,className:"input",rows:2,id:"description",placeholder:"Describe this route..."})}),e.jsx(fe,{})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(oe,{variant:"destructive",onClick:A,type:"button",size:"sm",children:[e.jsx(Yt,{className:"h-4 w-4 mr-1"}),"Delete"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{variant:"outline",onClick:G,children:"Cancel"}),e.jsxs($t,{type:"submit",loading:L,disabled:!v||!C,children:[e.jsx(bo,{className:"h-4 w-4 mr-1"}),"Save Changes"]})]})]})]})]}),e.jsxs(Fe,{className:"h-full pb-0",children:[e.jsx(He,{children:e.jsx(ze,{className:"text-base flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(jo,{className:"h-4 w-4"}),"Route Map"]})})}),e.jsxs(_e,{children:[e.jsx(Jt,{className:"mb-4",referenceLocation:s.at(0)?{lat:s[0].latitude,lng:s[0].longitude}:void 0,onSelect:(l,h)=>w(h)}),s.length===0?e.jsx("div",{className:"text-center text-gray-500 py-4",children:"No stops added yet. Search for places or click on the map to add stops."}):e.jsx("div",{className:" gap-2 flex flex-col",children:s.map((l,h)=>e.jsx(vn,{stop:l,onNavigateClicked:()=>{var b;(b=i.current)==null||b.setView([l.latitude,l.longitude],12)},moveStop:b=>f(h,b),totalStops:s.length},l.id))})]}),e.jsx(_e,{className:"p-0",children:e.jsx("div",{className:"h-96 rounded-lg overflow-hidden",children:e.jsxs(no,{className:"h-full w-full",zoomControl:!0,ref:i,scrollWheelZoom:!0,children:[e.jsx(V,{}),F.length>1&&e.jsx(io,{positions:F,color:"#3b82f6",weight:6,opacity:.8,dashArray:"5, 10"},`polyline-${s.length}-${s.map(l=>`${l.latitude},${l.longitude}`).join("-")}`),s.map((l,h)=>{if(l.latitude===0&&l.longitude===0)return null;const b=p===l.id;return e.jsx(ro,{draggable:!b,position:{lat:l.latitude,lng:l.longitude},eventHandlers:{moveend:R=>{t.mutateAsync({routeId:o.id,stopId:l.id,data:{latitude:R.target.getLatLng().lat,longitude:R.target.getLatLng().lng}})}},icon:Ve.divIcon({className:"custom-div-icon",html:`
                          <div style="
                            background-color: ${b?"#707070":"#3b82f6"};
                            width: 24px; 
                            height: 24px; 
                            border-radius: 50%; 
                            border: 2px solid white; 
                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: bold;
                            color: white;
                            font-size: 10px;
                          ">
                            ${h+1}
                          </div>
                        `,iconSize:[24,24],iconAnchor:[12,12]})},`${h}-${l.latitude}-${l.longitude}`)})]})})})]})]})})})}function yn({routeId:o}){const{data:r,isLoading:t,error:c}=oo(o);return r?e.jsx(wn,{route:r}):t?e.jsx(Ut,{}):c?e.jsxs("div",{className:"text-red-500",children:["Error loading route: ",c.message]}):e.jsx("div",{className:"text-gray-500",children:"No route found"})}const Ln=function(){const r=Ke(),{routeId:t,tripId:c}=zt.useParams();return e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("div",{children:e.jsxs(oe,{className:"mb-2",variant:"link",onClick:()=>r({to:"/admin/$tripId",params:{tripId:c}}),children:[e.jsx(po,{}),"Go back"]})}),e.jsx(yn,{routeId:t})]})};export{Ln as component};
